(self.webpackChunkapp_studio_enterprise_confidence_level_widget=self.webpackChunkapp_studio_enterprise_confidence_level_widget||[]).push([[7826],{57826:(E,k,l)=>{l.r(k),l.d(k,{WebSocketSubject:()=>f,webSocket:()=>v});var b=l(907),w=l(44500),y=l(99406),g=l(42486),S=l(39090);const m={url:"",deserializer:d=>JSON.parse(d.data),serializer:d=>JSON.stringify(d)},W="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }";class f extends b.k{constructor(t,o){if(super(),this._socket=null,t instanceof y.c)this.destination=o,this.source=t;else{const s=this._config=Object.assign({},m);if(this._output=new b.B,typeof t=="string")s.url=t;else for(const r in t)t.hasOwnProperty(r)&&(s[r]=t[r]);if(!s.WebSocketCtor&&WebSocket)s.WebSocketCtor=WebSocket;else if(!s.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new S.m}}lift(t){const o=new f(this._config,this.destination);return o.operator=t,o.source=this,o}_resetState(){this._socket=null,this.source||(this.destination=new S.m),this._output=new b.B}multiplex(t,o,s){const r=this;return new y.c(n=>{try{r.next(t())}catch(c){n.error(c)}const e=r.subscribe({next:c=>{try{s(c)&&n.next(c)}catch(i){n.error(i)}},error:c=>n.error(c),complete:()=>n.complete()});return()=>{try{r.next(o())}catch(c){n.error(c)}e.unsubscribe()}})}_connectSocket(){const{WebSocketCtor:t,protocol:o,url:s,binaryType:r}=this._config,n=this._output;let e=null;try{e=o?new t(s,o):new t(s),this._socket=e,r&&(this._socket.binaryType=r)}catch(i){n.error(i);return}const c=new g.yU(()=>{this._socket=null,e&&e.readyState===1&&e.close()});e.onopen=i=>{const{_socket:h}=this;if(!h){e.close(),this._resetState();return}const{openObserver:_}=this._config;_&&_.next(i);const p=this.destination;this.destination=w.vU.create(a=>{if(e.readyState===1)try{const{serializer:u}=this._config;e.send(u(a))}catch(u){this.destination.error(u)}},a=>{const{closingObserver:u}=this._config;u&&u.next(void 0),a&&a.code?e.close(a.code,a.reason):n.error(new TypeError(W)),this._resetState()},()=>{const{closingObserver:a}=this._config;a&&a.next(void 0),e.close(),this._resetState()}),p&&p instanceof S.m&&c.add(p.subscribe(this.destination))},e.onerror=i=>{this._resetState(),n.error(i)},e.onclose=i=>{e===this._socket&&this._resetState();const{closeObserver:h}=this._config;h&&h.next(i),i.wasClean?n.complete():n.error(i)},e.onmessage=i=>{try{const{deserializer:h}=this._config;n.next(h(i))}catch(h){n.error(h)}}}_subscribe(t){const{source:o}=this;return o?o.subscribe(t):(this._socket||this._connectSocket(),this._output.subscribe(t),t.add(()=>{const{_socket:s}=this;this._output.observers.length===0&&(s&&(s.readyState===1||s.readyState===0)&&s.close(),this._resetState())}),t)}unsubscribe(){const{_socket:t}=this;t&&(t.readyState===1||t.readyState===0)&&t.close(),this._resetState(),super.unsubscribe()}}function v(d){return new f(d)}}}]);
